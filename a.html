<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>Aether ¬∑ professional chat</title>
    <!-- Puter.js AI engine -->
    <script src="https://js.puter.com/v2/"></script>
    <!-- marked for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- canvas-confetti for subtle celebration -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>
    <!-- Font Awesome 6 (free icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f2f5f9;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            color: #1e2a3a;
        }

        /* main card ‚Äì minimal, sharp, professional */
        .chat-terminal {
            width: 100%;
            max-width: 1000px;
            background: #ffffff;
            border-radius: 28px;
            box-shadow: 0 20px 40px -12px rgba(0,20,40,0.25), 0 2px 6px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            height: min(85vh, 800px);
            overflow: hidden;
            border: 1px solid #eef2f6;
        }

        /* header ‚Äì subtle */
        .chat-header {
            padding: 1.25rem 2rem;
            border-bottom: 1px solid #eaeef4;
            background: #fafcff;
        }
        .chat-header h2 {
            font-weight: 500;
            font-size: 1.35rem;
            letter-spacing: -0.3px;
            color: #1a2c3f;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chat-header h2 i {
            color: #3471c1;
            font-size: 1.5rem;
        }

        /* message stream ‚Äì full width, scrollable */
        #message-stream {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem 2rem;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
        }

        /* message rows ‚Äì full width, no bubbles */
        .message-row {
            width: 100%;
            padding: 0.8rem 0;
            border-bottom: 1px solid #f0f3f8;
            transition: background 0.15s;
        }
        .message-row:hover {
            background: #f9fcff;
        }

        .user-row .message-content {
            text-align: right;
        }
        .ai-row .message-content {
            text-align: left;
        }

        .message-content {
            font-size: 1rem;
            line-height: 1.55;
            word-break: break-word;
            width: 100%;
        }

        /* markdown styling inside ai messages ‚Äì clean */
        .message-content h1, .message-content h2, .message-content h3 {
            margin: 0.7rem 0 0.3rem;
            font-weight: 550;
            color: #102433;
        }
        .message-content h1 { font-size: 1.7rem; border-bottom: 1px solid #dde3eb; padding-bottom: 0.15rem; }
        .message-content h2 { font-size: 1.5rem; }
        .message-content h3 { font-size: 1.25rem; }
        .message-content p { margin: 0.5rem 0; }
        .message-content ul, .message-content ol { margin: 0.4rem 0 0.6rem 1.8rem; }
        .message-content li { margin: 0.2rem 0; }
        .message-content code { background: #eef3f9; padding: 0.2rem 0.5rem; border-radius: 6px; font-size: 0.9rem; color: #1e3b5c; }
        .message-content pre { background: #1e2b3a; color: #e4f0fb; padding: 1rem; border-radius: 12px; overflow-x: auto; margin: 0.8rem 0; }
        .message-content blockquote { border-left: 4px solid #92bce0; padding-left: 1.2rem; margin: 1rem 0; color: #2d4d6e; }

        /* meta bar: timestamp + actions ‚Äì hidden until hover or always visible? we show subtle */
        .message-meta {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 0.35rem;
            font-size: 0.75rem;
            color: #96a9bc;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .message-row:hover .message-meta {
            opacity: 1;
        }
        .ai-row .message-meta {
            justify-content: flex-start;
        }
        .timestamp {
            font-feature-settings: 'tnum';
        }
        .copy-btn, .feedback-btn {
            background: none;
            border: none;
            color: #6c859c;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0.2rem 0.4rem;
            border-radius: 30px;
            transition: all 0.1s;
        }
        .copy-btn:hover {
            background: #e2ecf9;
            color: #1d4a7c;
        }
        .copy-notice {
            font-size: 0.7rem;
            color: #1f8b4c;
            margin-left: 0.2rem;
        }

        /* preloader / thinking indicator ‚Äì full width, minimal */
        .preloader-container {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.2rem 0 0.8rem 0;
            color: #507192;
        }
        .pulse-dots {
            display: flex;
            gap: 6px;
        }
        .pulse-dots div {
            width: 8px;
            height: 8px;
            background: #749ec7;
            border-radius: 50%;
            animation: pulse 1.4s infinite;
        }
        .pulse-dots div:nth-child(2) { animation-delay: 0.2s; background: #5880aa; }
        .pulse-dots div:nth-child(3) { animation-delay: 0.4s; background: #3d6690; }
        @keyframes pulse {
            0%, 80%, 100% { transform: scale(0.7); opacity: 0.5; }
            40% { transform: scale(1.1); opacity: 1; }
        }
        .preloader-text {
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        /* typewriter cursor */
        .cursor {
            display: inline-block;
            width: 2px;
            height: 1.2rem;
            background-color: #2b6cad;
            margin-left: 2px;
            vertical-align: middle;
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* input area ‚Äì clean, attached to bottom */
        .input-panel {
            border-top: 1px solid #e6ecf3;
            padding: 1.2rem 2rem;
            background: #f9fcff;
        }
        .input-group {
            display: flex;
            gap: 0.8rem;
            align-items: center;
            background: white;
            border: 1px solid #dde4ed;
            border-radius: 60px;
            padding: 0.2rem 0.2rem 0.2rem 1.8rem;
            box-shadow: 0 4px 12px rgba(0,20,30,0.02);
            transition: box-shadow 0.2s;
        }
        .input-group:focus-within {
            box-shadow: 0 8px 20px rgba(25, 85, 150, 0.1);
            border-color: #aac4e0;
        }
        .input-group input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 1rem 0.5rem;
            font-size: 1rem;
            outline: none;
            color: #152c3f;
        }
        .input-group input::placeholder {
            color: #a6bdd2;
            font-weight: 300;
        }
        .input-group button {
            background: #1e3d5e;
            border: none;
            color: white;
            font-weight: 500;
            padding: 0.8rem 2.2rem;
            border-radius: 60px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.15s;
            box-shadow: 0 4px 10px rgba(25, 70, 120, 0.2);
            border: 1px solid rgba(255,255,255,0.1);
            white-space: nowrap;
        }
        .input-group button:hover {
            background: #264f78;
            transform: scale(1.01);
        }

        /* quick suggestions (extra feature) */
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-top: 1rem;
        }
        .suggestion-chip {
            background: #ecf3fa;
            border-radius: 40px;
            padding: 0.4rem 1.2rem;
            font-size: 0.85rem;
            color: #1b3b5c;
            border: 1px solid #cddef0;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
        }
        .suggestion-chip:hover {
            background: #d5e5f7;
            border-color: #8eb3d7;
        }

        /* mobile adjustments */
        @media (max-width: 600px) {
            .chat-terminal { border-radius: 20px; height: 90vh; }
            .chat-header { padding: 1rem 1.5rem; }
            #message-stream { padding: 1rem 1.5rem; }
            .input-panel { padding: 1rem 1.5rem; }
            .input-group { padding-left: 1.2rem; }
            .input-group button { padding: 0.7rem 1.4rem; }
        }
    </style>
</head>
<body>
    <div class="chat-terminal">
        <div class="chat-header">
            <h2><i class="fa-regular fa-comment-dots"></i> Aether ¬∑ professional</h2>
        </div>

        <!-- messages container -->
        <div id="message-stream"></div>

        <!-- input + extras -->
        <div class="input-panel">
            <div class="input-group">
                <input type="text" id="user-query" placeholder="Ask me anything..." autofocus>
                <button id="send-btn"><i class="fa-regular fa-paper-plane" style="margin-right: 6px;"></i>Send</button>
            </div>

            <!-- extra feature: suggestion chips -->
            <div class="suggestions">
                <span class="suggestion-chip" data-prompt="What is machine learning?">üìò ML basics</span>
                <span class="suggestion-chip" data-prompt="Explain quantum computing in simple terms">‚öõÔ∏è Quantum</span>
                <span class="suggestion-chip" data-prompt="Write a thank you email after interview">‚úâÔ∏è email draft</span>
                <span class="suggestion-chip" data-prompt="Summarize the benefits of functional programming">üì¶ FP benefits</span>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // conversation for Puter AI
            const messages = [];
            const streamEl = document.getElementById('message-stream');
            const inputEl = document.getElementById('user-query');
            const sendBtn = document.getElementById('send-btn');

            // marked options
            marked.setOptions({ breaks: true, gfm: true, headerIds: false });

            // helper: smooth scroll to bottom
            function scrollToBottom() {
                streamEl.scrollTo({ top: streamEl.scrollHeight, behavior: 'smooth' });
            }

            // format current timestamp (HH:MM)
            function getTimestamp() {
                const d = new Date();
                return `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
            }

            // ---- add user message row (full width) ----
            function addUserMessage(text) {
                const row = document.createElement('div');
                row.className = 'message-row user-row';

                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.textContent = text; // user text plain
                row.appendChild(contentDiv);

                // meta: timestamp + copy (user can copy too? optional)
                const meta = document.createElement('div');
                meta.className = 'message-meta';
                meta.innerHTML = `<span class="timestamp"><i class="fa-regular fa-clock" style="margin-right: 4px;"></i>${getTimestamp()}</span>
                                  <button class="copy-btn" title="Copy message"><i class="fa-regular fa-copy"></i></button>`;
                row.appendChild(meta);

                // copy action
                meta.querySelector('.copy-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    navigator.clipboard.writeText(text);
                    const btn = e.currentTarget;
                    btn.innerHTML = '<i class="fa-regular fa-check"></i>';
                    setTimeout(() => { btn.innerHTML = '<i class="fa-regular fa-copy"></i>'; }, 1200);
                });

                streamEl.appendChild(row);
                scrollToBottom();
                return row;
            }

            // ---- create AI placeholder row (preloader, full width) ----
            function createAIPlaceholder() {
                const row = document.createElement('div');
                row.className = 'message-row ai-row';

                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';

                // preloader
                const loader = document.createElement('div');
                loader.className = 'preloader-container';
                loader.innerHTML = `<div class="pulse-dots"><div></div><div></div><div></div></div>
                                    <span class="preloader-text">Aether is thinking ...</span>`;
                contentDiv.appendChild(loader);
                row.appendChild(contentDiv);

                // meta will be added later after typewriter
                streamEl.appendChild(row);
                scrollToBottom();
                return { row, contentDiv, loader };
            }

            // ---- typewriter effect (incremental markdown) inside given contentDiv, returns promise
            async function typewriterEffect(contentDiv, fullMarkdown, speed = 18) {
                // clear preloader (contentDiv might have loader as only child, or we can empty)
                contentDiv.innerHTML = ''; 
                const raw = fullMarkdown;
                // we will append parts gradually
                for (let i = 0; i <= raw.length; i++) {
                    const partial = raw.substring(0, i);
                    // render markdown for current partial
                    const rendered = marked.parse(partial);
                    contentDiv.innerHTML = rendered;
                    // add cursor if not finished
                    if (i < raw.length) {
                        const cursorSpan = document.createElement('span');
                        cursorSpan.className = 'cursor';
                        contentDiv.appendChild(cursorSpan);
                    }
                    scrollToBottom();
                    await new Promise(r => setTimeout(r, speed));
                }
                // final clean render without cursor
                contentDiv.innerHTML = marked.parse(raw);
                scrollToBottom();
            }

            // ---- add AI meta (timestamp, copy) after typewriter ----
            function addAIMeta(row, rawText) {
                const meta = document.createElement('div');
                meta.className = 'message-meta';
                meta.innerHTML = `<span class="timestamp"><i class="fa-regular fa-clock"></i> ${getTimestamp()}</span>
                                  <button class="copy-btn" title="Copy message"><i class="fa-regular fa-copy"></i></button>`;
                row.appendChild(meta);

                // copy button: copy raw markdown (or plain text? we copy raw to preserve formatting)
                meta.querySelector('.copy-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    navigator.clipboard.writeText(rawText);
                    const btn = e.currentTarget;
                    btn.innerHTML = '<i class="fa-regular fa-check"></i>';
                    setTimeout(() => { btn.innerHTML = '<i class="fa-regular fa-copy"></i>'; }, 1200);
                });
            }

            // ---- confetti (subtle) ----
            function celebrate() {
                confetti({ particleCount: 50, spread: 70, origin: { y: 0.5, x: 0.3 }, colors: ['#d4e6ff', '#b3cef0', '#f2e5b6'] });
                confetti({ particleCount: 50, spread: 70, origin: { y: 0.5, x: 0.7 }, colors: ['#d4e6ff', '#b3cef0', '#f2e5b6'] });
            }

            // ---- main send handler ----
            async function handleSend(promptText = null) {
                const query = promptText !== null ? promptText : inputEl.value.trim();
                if (!query) return;

                // 1. add user message
                addUserMessage(query);
                messages.push({ role: 'user', content: query });
                inputEl.value = '';

                // 2. create AI placeholder (full width, preloader)
                const { row, contentDiv } = createAIPlaceholder();

                try {
                    // 3. call puter.ai
                    const response = await puter.ai.chat(messages, { model: 'gpt-3.5-turbo' });
                    const aiText = response.toString();

                    // store assistant message
                    messages.push({ role: 'assistant', content: aiText });

                    // 4. typewriter effect inside contentDiv
                    await typewriterEffect(contentDiv, aiText, 18);

                    // 5. add meta (timestamp, copy) to the row
                    addAIMeta(row, aiText);

                    // 6. celebrate
                    celebrate();
                } catch (error) {
                    console.error('AI error:', error);
                    contentDiv.innerHTML = `<span style="color: #b33c3c;"><i class="fa-regular fa-circle-exclamation"></i> Error ‚Äî check connection or try again.</span>`;
                    // add meta anyway (timestamp only)
                    const fallbackMeta = document.createElement('div');
                    fallbackMeta.className = 'message-meta';
                    fallbackMeta.innerHTML = `<span class="timestamp"><i class="fa-regular fa-clock"></i> ${getTimestamp()}</span>`;
                    row.appendChild(fallbackMeta);
                }
            }

            // event listeners
            sendBtn.addEventListener('click', () => handleSend());
            inputEl.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSend();
                }
            });

            // suggestion chips
            document.querySelectorAll('.suggestion-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    const prompt = chip.getAttribute('data-prompt');
                    if (prompt) handleSend(prompt);
                });
            });

            // welcome message (AI greeting, not stored in conversation, just visual)
            window.addEventListener('load', () => {
                if (streamEl.children.length === 0) {
                    const welcomeRow = document.createElement('div');
                    welcomeRow.className = 'message-row ai-row';
                    welcomeRow.innerHTML = `<div class="message-content">üëã Welcome. I'm **Aether**. Ask me anything ‚Äî responses are **full-width**, clean, and include markdown formatting. Use the suggestion chips or type freely.</div>`;
                    streamEl.appendChild(welcomeRow);
                    // render markdown
                    const contentDiv = welcomeRow.querySelector('.message-content');
                    contentDiv.innerHTML = marked.parse(contentDiv.textContent);
                    // add meta to welcome too (optional)
                    const meta = document.createElement('div');
                    meta.className = 'message-meta';
                    meta.innerHTML = `<span class="timestamp"><i class="fa-regular fa-clock"></i> ${getTimestamp()}</span>`;
                    welcomeRow.appendChild(meta);
                }
            });
        })();
    </script>
</body>
</html>